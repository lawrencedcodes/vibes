(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[544],{6201:(e,s,t)=>{Promise.resolve().then(t.bind(t,7708))},6046:(e,s,t)=>{"use strict";var a=t(6658);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},7708:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c,runtime:()=>i});var a=t(5155),r=t(2115),l=t(6046),n=t(8291);let i="edge";function c(){let e=(0,l.useRouter)(),s=(0,l.useParams)(),t=(0,n.Ht)(),i=(0,r.useRef)(null),[c,d]=(0,r.useState)([]),[o,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(null),[h,f]=(0,r.useState)(""),[g,j]=(0,r.useState)(!0),[p,v]=(0,r.useState)(!1),[N,y]=(0,r.useState)(""),b=s.connectionId;(0,r.useEffect)(()=>{if(!t){e.push("/login");return}if(!b){e.push("/connections");return}let s=async()=>{try{let s=await fetch("/api/messages/".concat(b));if(!s.ok){if(404===s.status){e.push("/connections");return}throw Error("Failed to fetch messages")}let t=await s.json();d(t.messages||[]),m(t.otherUser),u(t.connection),j(!1),w()}catch(e){y(e.message),j(!1)}};s();let a=setInterval(s,5e3);return()=>clearInterval(a)},[e,t,b]);let w=()=>{var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},_=async e=>{if(e.preventDefault(),h.trim()){v(!0),y("");try{let e=await fetch("/api/messages/".concat(b),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:h})});if(!e.ok)throw Error("Failed to send message");let s={...(await e.json()).message,first_name:null==t?void 0:t.firstName,last_name:null==t?void 0:t.lastName,photo_url:null};d([...c,s]),f(""),setTimeout(w,100)}catch(e){y(e.message)}finally{v(!1)}}},S=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),k=e=>new Date(e).toLocaleDateString();return g?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-lg text-gray-600",children:"Loading messages..."})})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,a.jsx)("header",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>e.push("/connections"),className:"mr-4 rounded-md bg-white p-1 text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:(0,a.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),o&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:o.photo_url?(0,a.jsx)("img",{className:"h-10 w-10 rounded-full",src:o.photo_url,alt:"".concat(o.first_name," ").concat(o.last_name)}):(0,a.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-gray-500 text-lg",children:[o.first_name[0],o.last_name[0]]})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsxs)("h1",{className:"text-xl font-bold text-gray-900",children:[o.first_name," ",o.last_name]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:(null==t?void 0:t.role)==="teacher"?"Learner":"Teacher"})]})]})]})})})}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col max-w-7xl w-full mx-auto",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-6 sm:px-6 lg:px-8",children:[N&&(0,a.jsx)("div",{className:"rounded-md bg-red-50 p-4 mb-6",children:(0,a.jsx)("div",{className:"flex",children:(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,a.jsx)("p",{children:N})})]})})}),(0,a.jsx)("div",{className:"space-y-4",children:0===c.length?(0,a.jsx)("div",{className:"text-center py-10",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No messages yet. Start the conversation!"})}):(0,a.jsxs)("div",{className:"space-y-4",children:[c.map((e,s)=>{let r=e.sender_id===(null==t?void 0:t.userId),l=0===s||k(c[s-1].created_at)!==k(e.created_at);return(0,a.jsxs)("div",{children:[l&&(0,a.jsx)("div",{className:"flex justify-center my-4",children:(0,a.jsx)("div",{className:"bg-gray-200 rounded-full px-4 py-1 text-xs text-gray-600",children:k(e.created_at)})}),(0,a.jsx)("div",{className:"flex ".concat(r?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"flex max-w-xs md:max-w-md ".concat(r?"flex-row-reverse":"flex-row"),children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:!r&&(0,a.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center mr-2",children:e.photo_url?(0,a.jsx)("img",{className:"h-8 w-8 rounded-full",src:e.photo_url,alt:"".concat(e.first_name," ").concat(e.last_name)}):(0,a.jsxs)("span",{className:"text-gray-500 text-sm",children:[e.first_name[0],e.last_name[0]]})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"rounded-lg px-4 py-2 ".concat(r?"bg-indigo-600 text-white mr-2":"bg-gray-100 text-gray-800"),children:(0,a.jsx)("p",{children:e.content})}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1 ".concat(r?"text-right mr-2":"text-left"),children:S(e.created_at)})]})]})})]},e.id)}),(0,a.jsx)("div",{ref:i})]})})]}),(0,a.jsx)("div",{className:"bg-white border-t border-gray-200 px-4 py-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("form",{onSubmit:_,className:"flex space-x-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{type:"text",placeholder:"Type a message...",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:h,onChange:e=>f(e.target.value),disabled:p})}),(0,a.jsx)("button",{type:"submit",disabled:p||!h.trim(),className:"inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:bg-indigo-400",children:p?"Sending...":"Send"})]})})]})]})}},8291:(e,s,t)=>{"use strict";function a(){return{userId:1,email:"user@example.com",role:"learner",firstName:"Demo",lastName:"User"}}t.d(s,{Ht:()=>a})}},e=>{var s=s=>e(e.s=s);e.O(0,[441,517,358],()=>s(6201)),_N_E=e.O()}]);